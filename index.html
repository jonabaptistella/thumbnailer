<!DOCTYPE html>
<html>
	<head>
		<!-- PAGE STUFF -->
		<meta charset="utf-8">
		<title>Wistia Thumbnail URL Generator</title>
		<meta name="author" content="Jeff Reiner">
	    <meta name="description" content="Get the URL of a Wistia video thumbnail!">
		<!-- CSS -->
		<link rel="stylesheet" href="master.css">
		<link rel="stylesheet" href="normalize.css">
		<!-- JS -->
		<script async defer src="https://buttons.github.io/buttons.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	</head>
	<body>
		<main>
			<div class="container">
				<div class="wrapper">
					<h1>Wistia Thumbnail URL Generator</h1>
					<div class="explainer">
						<p>Enter your Wistia account URL, the ID from the video you want, and the width and height you want it!</p>
						<!-- FOLLOW BUTTON -->
						<a class="github-button" href="https://github.com/mirshko" data-style="mega" data-count-href="/mirshko/followers" data-count-api="/users/mirshko#followers" data-count-aria-label="# followers on GitHub" aria-label="Follow @mirshko on GitHub">Follow @mirshko</a>
						<!-- STAR BUTTON -->
						<a class="github-button" href="https://github.com/mirshko/Wistia-Thumbnail-URL-Getter" data-icon="octicon-star" data-style="mega" data-count-href="/mirshko/Wistia-Thumbnail-URL-Getter/stargazers" data-count-api="/repos/mirshko/Wistia-Thumbnail-URL-Getter#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star mirshko/Wistia-Thumbnail-URL-Getter on GitHub">Star</a>
					</div>
					<!-- INPUT -->
					<form class="field" action="index.html" method="post">
						<input class="account-input spaced-input" id="wistiaAccountURL" type="url" name="wistiaAccountURL" placeholder="Enter Wistia Account URL">
						<br>
						<input class="spaced-input" id="wistiaID" type="text" name="wistiaID" placeholder="Enter Wistia ID">
						<input class="spaced-input" id="wistiaThumbWidth" type="number" name="wistiaThumbWidth" placeholder="Enter Width">
						<input id="wistiaThumbHeight" type="number" name="wistiaThumbHeight" placeholder="Enter Height">
						<!-- JUST DO IT!!! -->
						<br>
						<button id="getThumb" disabled="true" type="button" name="button">Get Thumbnail</button>
					</form>
					<div class="code-block">
						<pre><span id="thumbURL">Thumbnail URL</span></pre>
					</div>
					<img id="thumbPreview" class="responsive-img" src="http://placehold.it/320x180">
				</div>
			</div>
		</main>
		<script type="text/javascript">
			$(document).ready(function(){
				$('input').keyup(function() {
					var empty = false;
					$('input').each(function() {
					    if ($(this).val().length == 0)
					        empty = true;
					});
					if (empty)
					    $('#getThumb').attr('disabled',true);
					else
						$('#getThumb').attr('disabled', false);
				});
			});
			document.getElementById("getThumb").addEventListener("click", getThumbnail);
			function getThumbnail() {
				// GET VALUES FROM INPUT FIELDS
				var mediaHashedId = $('#wistiaID').val();
				var width = $('#wistiaThumbWidth').val();
				var height = $('#wistiaThumbHeight').val();
				// BUILD CALL TO WISTIA
				var baseUrl = "https://fast.wistia.com/oembed/?url=";
				var accountUrl = escape($('#wistiaAccountURL').val().replace('/projects', ''));
				console.log(accountUrl);
				function getThumbnailUrl(hashedId, callback) {
					$.getJSON(baseUrl + accountUrl + '/medias/' + mediaHashedId + "&format=json&callback=?", callback);
				}
				// PARSE THE JSON FILE FROM WISTIA
				function parseJSON(json) {
					var thumbnailURL = json.thumbnail_url.replace(/\d+x\d+/, width + 'x' + height);
					// DISPLAY IMAGE THUMBNAIL
					$('#thumbURL').text(thumbnailURL);
					$('#thumbPreview').attr("src", thumbnailURL);
				};
				// CALL THE FUNCTIONS TO GET THE ID FROM WISTIA AND THE INPUT FIELD
				getThumbnailUrl(mediaHashedId, parseJSON);
			}
		</script>
		<!-- GOOGLE ANALYTICS -->
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
			ga('create', 'UA-88254613-1', 'auto');
			ga('send', 'pageview');
		</script>
	</body>
</html>
