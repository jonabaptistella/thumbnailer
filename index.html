<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Wistia Thumbnail URL Generator</title>
		<link rel="stylesheet" href="https://necolas.github.io/normalize.css/5.0.0/normalize.css">
		<script async defer src="https://buttons.github.io/buttons.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	</head>
	<body>
		<style media="screen">
			html, input, button, pre { color: rgba(0,0,0,0.87); }
			@media only screen and (min-width: 0) { html { font-size: 15px; } }
			@media only screen and (min-width: 1075px) { html { font-size: 15.5px; } }
			@media only screen and (min-width: 1200px) { html { font-size: 16px; } }
			.container { margin: 0 auto; max-width: 1360px; width: 90%; }
			@media only screen and (min-width: 601px) { .container { width: 85%; } }
			@media only screen and (min-width: 1076px) { .container { width: 72.5%; } }
			@media only screen and (min-width: 1076px) and (max-width: 1440px) { .container { width: 85%; } }
			.code-block { margin-top: 48px; margin-bottom: 24px; padding: 24px; background-color: #EEE; border-radius: 3px; overflow: scroll; }
			.code-block pre { margin: 0; }
			.wrapper { margin-top: 48px; }
			.explainer { margin-bottom: 48px; }
			input { outline: none; width: 250px; box-sizing: border-box; border: none; border-bottom: 2px solid rgba(0,0,0,0.10); padding: 4px 8px; margin-bottom: 8px; transition: border-bottom .2s ease; }
			input.spaced-input { margin-right: 16px; }
			input.account-input { width: 400px; margin-bottom: 16px; }
			button { border-radius: 3px; background-color: #DDD; border: none; padding: 8px 16px; margin-top: 16px; }
			button:disabled { background-color: #EEE; color: rgba(0,0,0,0.38); }
			@media only screen and (max-width: 1076px) { input { width: 100%; max-width: 400px; margin-bottom: 16px; } }
			input:invalid { border-bottom: 2px solid rgba(255,0,0,0.76); }
			input:active, input:focus { border-bottom: 2px solid rgba(0,0,0,0.57); }
		</style>

		<main>
			<div class="container">
				<div class="wrapper">
					<h1>Wistia Thumbnail URL Generator</h1>
					<div class="explainer">
						<p>Enter your Wistia account URL, the ID from the video you want, and the width and height you want it!</p>
						<!-- FOLLOW BUTTON -->
						<a class="github-button" href="https://github.com/mirshko" data-style="mega" data-count-href="/mirshko/followers" data-count-api="/users/mirshko#followers" data-count-aria-label="# followers on GitHub" aria-label="Follow @mirshko on GitHub">Follow @mirshko</a>
						<!-- STAR BUTTON -->
						<a class="github-button" href="https://github.com/mirshko/Wistia-Thumbnail-URL-Getter" data-icon="octicon-star" data-style="mega" data-count-href="/mirshko/Wistia-Thumbnail-URL-Getter/stargazers" data-count-api="/repos/mirshko/Wistia-Thumbnail-URL-Getter#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star mirshko/Wistia-Thumbnail-URL-Getter on GitHub">Star</a>
					</div>
					<!-- INPUT -->
					<form class="field" action="index.html" method="post">
						<input class="account-input spaced-input" id="wistiaAccountURL" type="url" name="wistiaAccountURL" placeholder="Enter Wistia Account URL">
						<br>
						<input class="spaced-input" id="wistiaID" type="text" name="wistiaID" placeholder="Enter Wistia ID">
						<input class="spaced-input" id="wistiaThumbWidth" type="number" name="wistiaThumbWidth" placeholder="Enter Width">
						<input id="wistiaThumbHeight" type="number" name="wistiaThumbHeight" placeholder="Enter Height">
						<!-- JUST DO IT!!! -->
						<br>
						<button id="getThumb" disabled="true" type="button" name="button">Get Thumbnail</button>
					</form>
					<div class="code-block">
						<pre><span id="thumbURL">Thumbnail URL</span></pre>
					</div>
				</div>
			</div>
		</main>
		<script type="text/javascript">
			$(document).ready(function(){
				$('input').keyup(function() {
					var empty = false;
					$('input').each(function() {
					    if ($(this).val().length == 0)
					        empty = true;
					});
					if (empty)
					    $('#getThumb').attr('disabled',true);
					else
						$('#getThumb').attr('disabled', false);
				});
			});
			document.getElementById("getThumb").addEventListener("click", getThumbnail);
			function getThumbnail() {
				// GET VALUES FROM INPUT FIELDS
				var mediaHashedId = $('#wistiaID').val();
				var width = $('#wistiaThumbWidth').val();
				var height = $('#wistiaThumbHeight').val();
				// BUILD CALL TO WISTIA
				var baseUrl = "https://fast.wistia.com/oembed/?url=";
				var accountUrl = escape($('#wistiaAccountURL').val().replace('/projects', ''));
				console.log(accountUrl);
				function getThumbnailUrl(hashedId, callback) {
					$.getJSON(baseUrl + accountUrl + '/medias/' + mediaHashedId + "&format=json&callback=?", callback);
				}
				// PARSE THE JSON FILE FROM WISTIA
				function parseJSON(json) {
					var thumbnailURL = json.thumbnail_url.replace(/\d+x\d+/, width + 'x' + height);
					// DISPLAY IMAGE THUMBNAIL
					$('#thumbURL').text(thumbnailURL);
				};
				// CALL THE FUNCTIONS TO GET THE ID FROM WISTIA AND THE INPUT FIELD
				getThumbnailUrl(mediaHashedId, parseJSON);
			}
		</script>
		<!-- GOOGLE ANALYTICS -->
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
			ga('create', 'UA-88254613-1', 'auto');
			ga('send', 'pageview');
		</script>
	</body>
</html>
